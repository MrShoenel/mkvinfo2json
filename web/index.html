<!DOCTYPE html>
<html>
  <head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="./css/style.css" />
		<link href="./css/favicon.ico" rel="icon" type="image/x-icon" />

    <script data-require="angular.js@1.5.5" data-semver="1.5.5" src="./js/angular.min.js"></script>
		<script>
		(() => {
			window.jsonp = json => window.json = json;
			const s = document.createElement('script'),
				s1 = document.createElement('script');
			s.src = 'motion.js?r=' + Math.random();
			document.head.appendChild(s);
			s.onload = () => {
				document.head.appendChild(s1);
			};
			s1.src = './js/main.js?r=' + Math.random();
		})();
		</script>
		<title>Mkv Overview</title>
  </head>

  <body>
    <div ng-controller="Ctrl as vm">
			<header>
			<h1>MKV Overview</h1>
			<p class="byline">MKV Overview is a tool to display information about mkv-files that has been generated by <a href="https://mkvtoolnix.download/doc/mkvinfo.html"><code>mkvinfo</code></a> and processed into readable JSON(P) by <a href="https://github.com/MrShoenel/mkvinfo2json"><code>mkvinfo2json</code></a>.<br>The purpose of this tool is to analyze (parts of) a library with regard to its features, such as quality, available audio- or subtitle-tracks, duration or size. The 2nd purpose is to be able to export information about a selection of filtered MKVs for various purposes.</p>
			<h4 ng-hide="vm.isReady">Loading...</h4>
			</header>

			<section ng-cloak role="overview">
				<ul>
					<li><span>Created:</span> <code>{{ vm.mkvInfo.created }}</code></li>
					<li><span>Total Items, Size, Duration, Info-DB size:</span> <code>{{ vm.mkvs.length }}, {{ vm.sizeTotal | fileSize }}, {{ vm.durationTotal | duration }}, {{ vm.infoSize | fileSize }}</code></li>
					<li><span>Created with:</span> <code>{{ vm.mkvInfo.mkvInfoVersion }}</code></li>
					<li><span>Create-Args:</span> <code>{{ vm.createArgs }}</code></li>
				</ul>
			</section>
			<hr ng-cloak />
			<div ng-cloak class="options-row">
				<span>Display:</span>
				<fieldset>
					<input type="checkbox" checked ng-model="vm.colDura" ng-init="vm.colDura = true;" id="col-dura" />
					<label for="col-dura">Duration</label>
					<input type="checkbox" checked ng-model="vm.colDir" ng-init="vm.colDir = false;" id="col-dir" />
					<label for="col-dir">Directory</label>
					<input type="checkbox" checked ng-model="vm.colAudio" ng-init="vm.colAudio = true;" id="col-audio" />
					<label for="col-audio">Audio-Tracks</label>
					<input type="checkbox" checked ng-model="vm.colSubs" ng-init="vm.colSubs = true;" id="col-subs" />
					<label for="col-subs">Subtitles</label>
					<input type="checkbox" checked ng-model="vm.colQ" ng-init="vm.colQ = true;" id="col-q" />
					<label for="col-q">Quality</label>
					<input type="checkbox" checked ng-model="vm.colSize" ng-init="vm.colSize = true;" id="col-size" />
					<label for="col-size">Size</label>
					<input type="checkbox" checked ng-model="vm.colLinks" ng-init="vm.colLinks = true;" id="col-links" />
					<label for="col-links">IMDb/Wiki Links</label>
					<input type="checkbox" ng-model="vm.colHead" ng-init="vm.colHead = false;" id="col-head" />
					<label for="col-head">MKV-Header Info</label>
					<input type="checkbox" ng-model="vm.colSegInfo" ng-init="vm.colSegInfo = false;" id="col-segInfo" />
					<label for="col-segInfo">MKV-Segment Info</label>
					
					<br><br>
					<label for="audio-details">Audio-Details:</label>
					<select id="audio-details" ng-model="vm.audioDisplay" ng-init="vm.audioDisplay = 'names';" ng-change="vm.filterAudio = '';">
						<option value="names" selected>Audio-Track names</option>
						<option value="details">Audio-Track details</option>
					</select>
					<label for="subs-details" style="margin-left: 1em;">Subtitle-Details:</label>
					<select id="subs-details" ng-model="vm.subsDisplay" ng-init="vm.subsDisplay = 'names';" ng-change="vm.filterSubs = '';">
						<option value="names" selected>Subtitle names</option>
						<option value="details">Subtitle details</option>
					</select>
					<input type="checkbox" ng-model="vm.showHevcOnly" ng-init="vm.showHevcOnly = false;" id="show-hevc-only" ng-change="vm.filter()" style="margin-left: 1em;" />
					<label for="show-hevc-only">HEVC only</label>
				</fieldset>
			</div>
			<div ng-cloak class="options-row">
				<span>Show types:</span>
				<fieldset>
					<input type="checkbox" checked ng-model="vm.showMovies" ng-init="vm.showMovies = true;" id="show-movies" ng-change="vm.filter()" />
					<label for="show-movies">Movies</label>
					<input type="checkbox" checked ng-model="vm.showSeries" ng-init="vm.showSeries = true;" id="show-series" ng-change="vm.filter()" />
					<label for="show-series">Series</label>
					<input type="checkbox" checked ng-model="vm.showExtra" ng-init="vm.showExtra = true;" id="show-extra" ng-change="vm.filter()" />
					<label for="show-extra">Extra</label>
					<input type="checkbox" checked ng-model="vm.showBonus" ng-init="vm.showBonus = true;" id="show-bonus" ng-change="vm.filter()" />
					<label for="show-bonus">Bonus</label>
					<input type="checkbox" checked ng-model="vm.showOther" ng-init="vm.showOther = true;" id="show-other" ng-change="vm.filter()" />
					<label for="show-other">Other</label>
				</fieldset>
			</div>
			<div ng-cloak class="options-row">
				<span>Special filters:</span>
				<fieldset>
					<label for="special-tracks">By Tracks:</label>
					<select id="special-tracks" ng-model="vm.filterTrackType" ng-init="vm.filterTrackType = '';" ng-change="vm.filter()">
						<option value="" selected>(do not use)</option>
						<option value="audio">Audio-Tracks</option>
						<option value="subtitles">Subtitle-Tracks</option>
						<option value="video">Video-Tracks</option>
					</select>

					<select ng-model="vm.filterTrackSelect" ng-init="vm.filterTrackSelect = 'any';" ng-change="vm.filter()">
						<option value="any">where any has</option>
						<option value="all">where all have</option>
						<option value="none">where none has</option>
					</select>

					<select ng-model="vm.filterTrackField" ng-init="vm.filterTrackField = 'uid';" ng-change="vm.filter()">
						<option value="uid">UID</option>
						<option value="type">Type</option>
						<option value="codecId">Codec-ID</option>
						<option value="language">language</option>
						<option value="name">name</option>
						<option value="sampFreq">Sample-Freq.</option>
						<option value="channels"># of Channels</option>
						<option value="pxWidth">Pixels (width)</option>
						<option value="pxHeight">Pixels (height)</option>
					</select>

					<select ng-model="vm.filterTrackCompare" ng-init="vm.filterTrackCompare = 'eq_ic';" ng-change="vm.filter()">
						<option value="eq_ic">equal to (ignore case)</option>
						<option value="eq">equal to</option>
						<option value="con_ic">contain (ignore case)</option>
						<option value="con">contain</option>
						<option value="miss">field missing</option>
					</select>

					<input type="text" placeholder="Type Value.." ng-model="vm.filterTrackVal" ng-init="vm.filterTrackVal = ''" ng-change="vm.filter()" />
				</fieldset>
			</div>
			<hr ng-cloak />
			<p ng-cloak>
				Items currently matching filter: {{ vm.mkvsFiltered.length }} ({{ vm.mkvsFilteredSize | fileSize }} / {{ vm.mkvsFilteredDuration | duration }})
			</p>
			<p ng-cloak>
				Items currently selected: {{ vm.mkvsSelected.length }} ({{ vm.mkvsSelectedSize | fileSize }} / {{ vm.mkvsSelectedDuration | duration }})
				<button ng-click="vm.selectAll()" style="margin-left: 1em;">Select All</button>
				<button ng-disabled="vm.mkvsSelected.length == 0;" ng-click="vm.selectNone()">Clear Selection</button>
				<select ng-model="vm.exportType" ng-init="vm.exportType = 'name';" style="width: 10em;">
					<option value="name" selected>Name Only</option>
					<option value="name-dir">Name + Directory</option>
					<option value="extended">Name, Directory, Duration, Audio, Subs, Size, Quality</option>
					<option value="all">Complete</option>
				</select>
				<button ng-disabled="vm.mkvsSelected.length == 0;" ng-click="vm.exportSelection()">Export</button>
			</p>
			<table ng-cloak>
				<thead>
					<tr role="filtering">
						<th colspan="2" role="active-filters" ng-show="vm.filterName || vm.filterDir || vm.filterAudio || vm.filterSubs || vm.filterQ || vm.filterSize || vm.filterHead || vm.filterSegInfo">
							Filters active:
							<div>
								<div ng-if="vm.filterName">Name = <code>"{{ vm.filterName }}"</code></div>
								<div ng-if="vm.filterDir">Directory = <code>"{{ vm.filterDir }}"</code></div>
								<div ng-if="vm.filterAudio">Audio-Tracks = <code>"{{ vm.filterAudio }}"</code></div>
								<div ng-if="vm.filterSubs">Subtitles = <code>"{{ vm.filterSubs }}"</code></div>
								<div ng-if="vm.filterQ">Quality = <code>"{{ vm.filterQ }}"</code></div>
								<div ng-if="vm.filterSize">Size = <code>"{{ vm.filterSize }}"</code></div>
								<div ng-if="vm.filterHead">Head = <code>"{{ vm.filterHead }}"</code></div>
								<div ng-if="vm.filterSegInfo">SegInfo = <code>"{{ vm.filterSegInfo }}"</code></div>
							</div>
						</th>
						<th colspan="999">
							Sort By:
							<select ng-model="vm.sortBy" ng-init="vm.sortBy = '';" ng-change="vm.sort()">
								<option value="">(do not sort)</option>
								<option value="name">Name</option>
								<option value="duration">Duration</option>
								<option value="dirName">Directory</option>
								<option value="quality">Quality (Resolution)</option>
								<option value="fileSize">Size</option>
							</select>
							<select ng-model="vm.sortDir" ng-init="vm.sortDir = 'asc';" ng-change="vm.sort()">
								<option value="asc">ascending</option>
								<option value="desc">descending</option>
							</select>
						</th>
					</tr>
					<tr>
						<th role="checkmark" rowspan="2">&#x2713;</th>
						<th role="name">Name</th>
						<th rowspan="2" ng-show="vm.colDura">Duration</th>
						<th role="dir" ng-show="vm.colDir">Directory</th>
						<th ng-show="vm.colAudio">Audio-Tracks</th>
						<th ng-show="vm.colSubs">Subtitles</th>
						<th role="quality" ng-show="vm.colQ">Quality</th>
						<th ng-show="vm.colSize" role="size">Size</th>
						<th rowspan="2" ng-show="vm.colLinks">IMDb</th>
						<th rowspan="2" ng-show="vm.colLinks">Wiki</th>
						<th ng-show="vm.colHead">Header</th>
						<th ng-show="vm.colSegInfo">Segm.-Info</th>
					</tr>
					<tr>
						<th role="name">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterName" ng-init="vm.filterName = '';" ng-change="vm.filter()" />
						</th>
						<th role="dir" ng-show="vm.colDir">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterDir" ng-init="vm.filterDir = '';" ng-change="vm.filter()" />
						</th>
						<th ng-show="vm.colAudio">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterAudio" ng-init="vm.filterAudio = '';" ng-disabled="vm.audioDisplay == 'details';" ng-change="vm.filter()" />
						</th>
						<th ng-show="vm.colSubs">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterSubs" ng-init="vm.filterSubs = '';" ng-disabled="vm.subsDisplay == 'details';" ng-change="vm.filter()" />
						</th>
						<th role="quality" ng-show="vm.colQ">
							<select ng-model="vm.filterQ" ng-init="vm.filterQ = '';" ng-change="vm.filter()">
								<option value="" selected>(no minimum)</option>
								<option value="4k">4K+ (3840x2160)</option>
								<option value="fhd">FullHD+ (1920x1080)</option>
								<option value="hd">HD+ (1280x720)</option>
							</select>
						</th>
						<th ng-show="vm.colSize" role="size">
							<input type="text" placeholder="Limit (MB)" ng-model="vm.filterSize" ng-init="vm.filterSize = '';" ng-change="vm.filter()" />
						</th>
						<th ng-show="vm.colHead">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterHead" ng-init="vm.filterHead = '';" ng-change="vm.filter()" />
						</th>
						<th ng-show="vm.colSegInfo">
							<input type="text" placeholder="Type to filter.." ng-model="vm.filterSegInfo" ng-init="vm.filterSegInfo = '';" ng-change="vm.filter()" />
						</th>
					</tr>
				</thead>

				<tbody>
					<tr ng-repeat="mkv in vm.mkvsFiltered">
						<td role="checkmark">
							<input type="checkbox" ng-model="mkv.ui.selected" ng-init="mkv.ui.selected = false;" id="mkv-selected-{{ mkv.aiId }}" ng-change="vm.updateSelected()" />
						</td>
						<td role="name"><label for="mkv-selected-{{ mkv.aiId }}">{{ mkv.name }}</label></td>
						<td ng-if="vm.colDura">{{ mkv.duration | duration }}</td>
						<td role="dir" ng-if="vm.colDir">{{ mkv.dirName }}</td>
						<td ng-if="vm.colAudio">
							<span ng-if="vm.audioDisplay == 'names'">{{ mkv.audioTracksNames }}</span>
							<div role="audio-details" class="code" ng-if="vm.audioDisplay == 'details'">
								<div ng-repeat="t in mkv.audioTracks">♫ {{ t.language }}, {{ t.codecId }}, Ch./Freq: {{ t.channels }}/{{ t.sampFreq }}</div>
							</div>
						</td>
						<td ng-if="vm.colSubs">
							<span ng-if="vm.subsDisplay == 'names'">{{ mkv.subTracksNames }}</span>
							<div role="subs-details" class="code" ng-if="vm.subsDisplay == 'details'">
								<div ng-repeat="t in mkv.subTracks">&para; {{ t.language }}, {{ t.codecId }}</div>
							</div>
						</td>
						<td role="quality" ng-if="vm.colQ">{{ mkv.isHd ? 'HD' : (mkv.isFullHd ? 'FullHD' : (mkv.is4K ? '4K' : mkv.videoTrack.pxWidth + 'x' + mkv.videoTrack.pxHeight)) }}</td>
						<td ng-if="vm.colSize" role="size">{{ mkv.fileSize | fileSize }}</td>
						<td ng-if="vm.colLinks"><a target="_blank" href="https://www.google.com/search?q=IMDb {{mkv.name}}">IMDb</a></td>
						<td ng-if="vm.colLinks"><a target="_blank" href="https://www.google.com/search?q=wikipedia {{mkv.name}}">Wiki</a></td>
						<td ng-if="vm.colHead">
							<pre>{{ mkv.headString }}</pre>
							<!--<div ng-repeat="(key, value) in mkv.head">{{ key }}<span ng-if="value">: {{ value }}</span></div>-->
						</td>
						<td ng-if="vm.colSegInfo">
							<pre>{{ mkv.segInfoString }}</pre>
							<!--<div ng-repeat="(key, value) in mkv.segInfo">{{ key }}<span ng-if="value">: {{ value }}</span></div>-->
						</td>
					</tr>
				</tbody>
			</table>
			<hr>
    </div>
  </body>
</html>
